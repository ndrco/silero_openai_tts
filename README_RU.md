# Silero OpenAI-совместимый TTS

**Локальный**, self-hosted сервер синтеза речи (TTS), реализующий **OpenAI TTS API** (`POST /v1/audio/speech`).

Основная цель проекта — предоставить **готовый к использованию, OpenAI API-совместимый TTS-бэкенд** для
[OpenClaw](https://github.com/openclaw/openclaw) — чтобы OpenClaw мог озвучивать текст без обращения к внешним облачным сервисам.
Тем не менее, сервер работает с **любым** проектом, который ожидает OpenAI-совместимый TTS-endpoint: достаточно указать клиенту базовый URL этого сервера.

Внутри используются модели **Silero TTS** через `torch.hub` (загружаются при первом запуске), а также небольшой конвейер нормализации текста, ориентированный на **русский и английский языки**, включая **преобразование чисел в слова**.

---

## Возможности

- **Совместимость с OpenAI API**: реализует `POST /v1/audio/speech` с привычными полями запроса:
  `model`, `input`, `voice`, `response_format`, `speed`.
- **Разработан для OpenClaw**, но работает с любым OpenAI-совместимым клиентом.
- **Поддержка русского и английского языков** (переключается через конфигурацию).
- **Естественное произношение чисел**:
  - преобразование целых чисел в слова;
  - для русского языка — согласование формы существительного с числом (например: «21 рубль / 22 рубля / 25 рублей»);
  - развёртывание распространённых шаблонов вроде `%` и `₽`.
- **Несколько голосов**:
  - принимает имена голосов OpenAI (`alloy`, `echo`, `fable`, `onyx`, `nova`, `shimmer`) и сопоставляет их со спикерами Silero;
  - также принимает ID спикеров Silero напрямую.
- **Несколько форматов вывода**: `wav`, `mp3`, `opus`, `aac`, `flac`.
- **Управление скоростью воспроизведения** (`0.25`–`4.0`) через аудиофильтры FFmpeg.
- **Дисковый кеш** для повторяющихся фраз.
- **Опциональный API-ключ** (Bearer-токен).
- **Работа на CPU по умолчанию**, с поддержкой GPU (CUDA).

---

## Быстрый старт

### Системные зависимости

```bash
sudo apt update
sudo apt install -y ffmpeg libsndfile1
```

### Python-окружение

```bash
python -m venv .venv
source .venv/bin/activate
pip install -U pip
pip install -e .
```

### Запуск

```bash
uvicorn app.main:app --host 0.0.0.0 --port 8000
```

---

## API

### Endpoint

`POST /v1/audio/speech`

### Поля запроса

| Поле | Тип | Обязательно | Примечание |
|------|------|------------|------------|
| model | string | да | Для совместимости. Игнорируется сервером. |
| input | string | да | Текст для синтеза. |
| voice | string | да | Имя голоса или ID спикера Silero. |
| response_format | string | нет | wav (по умолчанию), mp3, opus, aac, flac |
| speed | number | нет | Скорость (0.25–4.0) |

---

## Лицензия

MIT License.
